# NS Trains tvOS - Native Swift/SwiftUI

Pure native tvOS app for displaying NS (Nederlandse Spoorwegen) train departure information.

## Overview

This is a **native Swift/SwiftUI tvOS application** - no React Native, no Expo, no build tool complexity. Just clean, modern Apple development.

## Features

- ✅ Native SwiftUI interface
- ✅ NS brand colors (Blue #003082, Yellow #FFC917)
- ✅ tvOS-optimized layout and typography
- ✅ Welcome screen with "Get Started" button
- ✅ Station selector with search and focus navigation
- ✅ Live departure board with real-time NS API data
- ✅ Auto-refresh every 30 seconds
- ✅ Platform change indicators
- ✅ Delay information and status (on-time, delayed, cancelled)
- ✅ Via stations display
- ✅ Embedded train map showing nearby trains in real-time
  - Shows trains within 50km of selected station
  - Custom train icons with direction indicators
  - Train type (IC, SPR) and journey number displayed
  - Auto-refreshes every 30 seconds with departure data

## Requirements

- **Xcode 16+** with tvOS SDK
- **macOS** with Apple Silicon or Intel
- **Apple TV** (physical device or simulator)
- **Swift 5.0+**
- **NS API Key** (free, instructions below)

## Getting Your NS API Key

This app uses the Nederlandse Spoorwegen (NS) public API to fetch real-time train departure data. You need a free API key to use the app.

### Steps to Get Your Free API Key:

1. Visit the **NS API Portal**: https://apiportal.ns.nl
2. Create a free account (if you don't have one)
3. Subscribe to the **Reisinformatie API** (Travel Information API)
4. Copy your **Subscription Key** (Ocp-Apim-Subscription-Key)

### Configure the API Key

You need to set the API key as an environment variable in Xcode:

1. Open `NSTrains-tvOS.xcodeproj` in Xcode
2. Select the **NSTrains-tvOS** scheme (top bar, next to device selector)
3. Click **Edit Scheme** (or press `Cmd+<`)
4. Select **Run** → **Arguments** tab
5. Under **Environment Variables**, add:
   - **Name**: `NS_API_KEY`
   - **Value**: `your-api-key-here`
6. Click **Close**

The app will now use your API key to fetch live departure data from the NS API.

## Project Setup

### Install XcodeGen (One-Time)

```bash
brew install xcodegen
```

XcodeGen generates the Xcode project from `project.yml`, so you never have to manually configure project settings in Xcode.

### Generate Xcode Project

```bash
cd NSTrains-tvOS
xcodegen generate
```

This creates `NSTrains-tvOS.xcodeproj` from the configuration in `project.yml`.

### Open in Xcode

```bash
open NSTrains-tvOS.xcodeproj
```

## Running the App

### Option 1: Apple TV Simulator

1. Open `NSTrains-tvOS.xcodeproj` in Xcode
2. Select **Apple TV** from device dropdown (top bar)
3. Click **Run** button (▶️) or press `Cmd+R`

### Option 2: Physical Apple TV

1. Connect Apple TV (WiFi paired via Xcode Devices)
2. Select your **Apple TV** from device dropdown
3. Xcode may prompt for signing - select your Team
4. Click **Run** (▶️)

## Development Workflow

**Initial build:**
1. `xcodegen generate` (creates project)
2. Open in Xcode
3. Click Run

**Making changes:**
1. Edit Swift files in your favorite editor (VS Code, etc.)
2. Xcode auto-detects changes
3. Re-run to see updates (Cmd+R)

**When project structure changes:**
1. Update `project.yml`
2. Run `xcodegen generate`
3. Reopen project in Xcode

## Project Structure

```
NSTrains-tvOS/
├── project.yml                       # XcodeGen configuration
├── NSTrains-tvOS.xcodeproj          # Generated by xcodegen (gitignored)
├── NSTrains-tvOS/
│   ├── App/
│   │   └── NSTrainsApp.swift        # App entry point
│   ├── Views/
│   │   └── WelcomeView.swift        # POC welcome screen (SwiftUI)
│   ├── Models/
│   │   ├── Station.swift            # Station data model
│   │   └── Departure.swift          # Departure data model
│   ├── Services/
│   │   └── NSAPIService.swift       # NS API integration
│   ├── Utilities/
│   │   └── NSColors.swift           # NS brand colors
│   └── Info.plist                   # App configuration
└── README.md                        # This file
```

## Code Signing

**First run will prompt for signing:**
1. Xcode: Select target "NSTrains-tvOS"
2. Signing & Capabilities tab
3. Team: Select your Apple ID
4. Bundle Identifier: `com.amberglass.nstrains.tvos` (pre-configured)

After initial setup, Xcode remembers your signing configuration.

## NS API Integration

**API Service** is ready in `Services/NSAPIService.swift`:

```swift
// Fetch all stations
let stations = try await NSAPIService.shared.fetchStations()

// Fetch departures for a station
let departures = try await NSAPIService.shared.fetchDepartures(for: "AMS")
```

**API Key** is included (public NS API key from their portal).

## Advantages Over Expo/React Native

✅ **No build tool complexity** - Just open and run
✅ **Native performance** - Direct tvOS APIs, no JavaScript bridge
✅ **Standard Apple workflow** - Works like any iOS/tvOS app
✅ **Built-in focus engine** - tvOS handles remote navigation
✅ **Xcode Instruments** - Full Apple debugging tools
✅ **SwiftUI** - Modern, declarative UI
✅ **Hot restart** - Cmd+R reloads instantly

## NS Brand Colors

```swift
Color.nsBlue    // #003082 - Primary blue
Color.nsYellow  // #FFC917 - Yellow accent
```

Pre-configured in `Utilities/NSColors.swift` as Color and UIColor extensions.

## Troubleshooting

**"Command not found: xcodegen"**
```bash
brew install xcodegen
```

**"No such file or directory: .xcodeproj"**
```bash
xcodegen generate
```

**"Signing for NSTrains-tvOS requires a development team"**
- Open project in Xcode
- Select target → Signing & Capabilities
- Choose your Apple ID team

**"Apple TV not showing in device list"**
- Window → Devices and Simulators
- Verify Apple TV is connected/paired
- Enable Developer Mode on Apple TV

## Next Steps

After verifying the POC runs:

1. **Station Selector** - Focusable list with search
2. **Departure Board** - Live departures with auto-refresh
3. **Train Map** - Netherlands railway network visualization

## App Flow

1. **Welcome Screen** → Click "Get Started"
2. **Station Selector** → Browse/search stations, select one
3. **Departure Board** → View live departures with auto-refresh
4. **Back Button** → Return to station selector

## Version

**v0.2.0** - Full functional app with live data

---

Built with ❤️ by Amberglass
